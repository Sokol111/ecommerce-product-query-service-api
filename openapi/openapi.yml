openapi: 3.0.0
info:
  title: Product query API
  version: 1.0.15
  description: API for querying products
paths:
  /v1/product/get/{id}:
    get:
      summary: Get a product by ID
      operationId: getProductById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Product retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductResponse"
        "404":
          description: Product not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "500":
          description: Standard internal error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
  /v1/product/random:
    get:
      summary: Get random products
      operationId: getRandomProducts
      parameters:
        - name: count
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 20
            example: 5
          description: Number of random products to retrieve (1-20)
      responses:
        "200":
          description: Random products retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProductResponse"
        "400":
          description: Validation error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "500":
          description: Standard internal error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
  /v1/product/list:
    get:
      summary: Get a paginated list of products with filtering and sorting
      operationId: getProductList
      parameters:
        - name: page
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
            example: 1
          description: Page number (must be greater than 0)
        - name: size
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 100
            example: 20
          description: Number of items per page (max 100)
        - name: categoryId
          in: query
          required: false
          schema:
            type: string
            example: "123e4567-e89b-12d3-a456-426614174000"
          description: Filter by category ID
        - name: sort
          in: query
          required: false
          schema:
            type: string
            enum: [name, price, quantity]
            example: name
          description: Field to sort by
        - name: order
          in: query
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
            example: desc
          description: Sort order (ascending or descending)
        - name: minPrice
          in: query
          required: false
          schema:
            type: number
            minimum: 0
          description: Minimum price filter
        - name: maxPrice
          in: query
          required: false
          schema:
            type: number
            minimum: 0
          description: Maximum price filter
        - name: attributeFilters
          in: query
          required: false
          schema:
            type: string
          description: |
            JSON-encoded array of attribute filters.
            Each filter has: slug (string), values (string[]), min (number), max (number).
            Example: [{"slug":"color","values":["red","blue"]},{"slug":"storage","min":128,"max":512}]
      responses:
        "200":
          description: List of products retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductListResponse"
        "400":
          description: Validation error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "500":
          description: Standard internal error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
components:
  schemas:
    ProductListResponse:
      type: object
      required:
        - items
        - page
        - size
        - total
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ProductResponse"
        page:
          type: integer
          example: 1
          description: Current page number
        size:
          type: integer
          example: 20
          description: Number of items per page
        total:
          type: integer
          example: 100
          description: Total number of items
    ProductResponse:
      type: object
      required:
        - id
        - name
        - price
        - quantity
      properties:
        id:
          type: string
          example: "678b74a36fc2b2605c6f579d"
        name:
          type: string
          example: "Smartphone model X"
        description:
          type: string
          example: "High-quality smartphone with advanced features"
        price:
          type: number
          example: 10.50
        quantity:
          type: integer
          example: 10
        imageId:
          type: string
          description: ID of the product's main image
          example: "550e8400-e29b-41d4-a716-446655440000"
        imageUrl:
          type: string
          description: URL of the product's main image
          example: "https://cdn.example.com/images/550e8400-e29b-41d4-a716-446655440000.jpg"
        categoryId:
          type: string
          description: ID of the product's category
          example: "123e4567-e89b-12d3-a456-426614174000"
        attributes:
          type: array
          description: List of attribute values for this product
          items:
            $ref: "#/components/schemas/ProductAttribute"

    ProductAttribute:
      type: object
      description: Product attribute with value
      required:
        - attributeId
        - slug
      properties:
        attributeId:
          type: string
          example: "123e4567-e89b-12d3-a456-426614174000"
          description: Reference to the attribute definition
        slug:
          type: string
          example: "color"
          description: URL-friendly identifier for filtering (denormalized from attribute definition)
        optionSlug:
          type: string
          example: "red"
          description: Slug of the selected option (for single type)
        optionSlugs:
          type: array
          description: Slugs of selected options (for multiple type)
          items:
            type: string
          example: ["wifi", "bluetooth", "nfc"]
        numericValue:
          type: number
          example: 128
          description: Numeric value (for range type attributes like RAM, storage, weight)
        textValue:
          type: string
          example: "Custom engraving text"
          description: Free text value (for text type attributes)
        booleanValue:
          type: boolean
          example: true
          description: Boolean value (for boolean type attributes)

    Problem:
      type: object
      description: RFC7807 Problem Details
      required: [type, title, status]
      properties:
        type: { type: string, format: uri }
        title: { type: string }
        status: { type: integer }
        detail: { type: string }
        instance: { type: string, format: uri }
        traceId: { type: string }
        errors:
          type: array
          items:
            type: object
            properties:
              field: { type: string }
              message: { type: string }
